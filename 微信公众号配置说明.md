# 微信公众号配置说明

## 概述

本项目已从使用第三方WxPusher服务改为使用微信公众号官方API进行内容发布。这意味着新闻联播内容将直接发布到您的微信公众号，而不是通过第三方服务推送。

## 配置步骤

### 1. 获取微信公众号开发者权限

1. 登录[微信公众平台](https://mp.weixin.qq.com/)
2. 进入"开发"→"基本配置"
3. 获取以下信息：
   - **AppID**：开发者ID
   - **AppSecret**：开发者密码

### 2. 修改配置文件

编辑 `config.py` 文件，将以下配置替换为您的实际信息：

```python
# 微信公众号配置
WECHAT_APP_ID = "您的微信公众号AppID"  # 替换为实际的AppID
WECHAT_APP_SECRET = "您的微信公众号AppSecret"  # 替换为实际的AppSecret
```

### 3. 环境变量配置（可选）

您也可以通过环境变量设置微信公众号配置：

```bash
# Windows PowerShell
$env:WECHAT_APP_ID="您的AppID"
$env:WECHAT_APP_SECRET="您的AppSecret"

# Linux/Mac
 export WECHAT_APP_ID="您的AppID"
 export WECHAT_APP_SECRET="您的AppSecret"
```

## 功能说明

### 新的微信公众号API功能

1. **文章发布**：新闻联播内容将作为图文消息发布到微信公众号
2. **图片上传**：关键词分析生成的词云图将上传到公众号素材库
3. **草稿管理**：内容先创建为草稿，然后发布
4. **自动刷新Token**：access_token自动管理，无需手动刷新

### 主要变更

- **移除**：WxPusher相关的第三方API调用
- **新增**：微信公众号官方API集成
- **保留**：原有的新闻联播内容获取和分析功能

## 使用限制

### 微信公众号API限制

1. **调用频率限制**：
   - 获取access_token：2000次/天
   - 上传素材：1000次/天
   - 发布文章：无明确限制，但建议合理使用

2. **素材管理**：
   - 图片大小限制：2MB
   - 图片格式：bmp, png, jpeg, jpg, gif

3. **内容审核**：所有发布内容需符合微信公众号内容规范

### 功能对比

| 功能 | 原WxPusher | 新微信公众号API |
|------|------------|----------------|
| 消息推送 | 个人消息推送 | 公众号文章发布 |
| 受众范围 | 关注WxPusher的用户 | 公众号所有粉丝 |
| 内容形式 | 文本/图片消息 | 图文消息 |
| 管理方式 | 第三方平台 | 微信公众平台 |

## 测试配置

运行以下命令验证配置是否正确：

```bash
python config.py
```

如果配置正确，将显示：
```
=== 配置信息 ===
微信公众号AppID: wx123456...
微信公众号AppSecret: ********
开始日期: 20250101
结束日期: current
================
配置验证通过
```

## 故障排除

### 常见问题

1. **"获取access_token失败"**
   - 检查AppID和AppSecret是否正确
   - 确认微信公众号已开通开发者权限

2. **"草稿创建失败"**
   - 检查内容是否符合微信公众号内容规范
   - 确认网络连接正常

3. **"图片上传失败"**
   - 检查图片大小是否超过2MB
   - 确认图片格式是否支持

### 日志查看

所有操作日志记录在 `xwlb.log` 文件中，可通过查看日志了解详细错误信息。

## 安全建议

1. **保护AppSecret**：不要将AppSecret提交到公开仓库
2. **使用环境变量**：建议使用环境变量存储敏感信息
3. **定期更换**：定期更换AppSecret以提高安全性
4. **权限控制**：仅授予必要的API权限

## 后续开发

如需进一步定制功能，可参考：

1. [微信公众平台开发文档](https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html)
2. [素材管理API](https://developers.weixin.qq.com/doc/offiaccount/Asset_Management/New_temporary_materials.html)
3. [草稿箱API](https://developers.weixin.qq.com/doc/offiaccount/Draft_Box/Add_draft.html)